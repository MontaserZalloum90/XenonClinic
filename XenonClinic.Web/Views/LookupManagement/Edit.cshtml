@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model XenonClinic.Web.Models.LookupEditViewModel
@{
    ViewData["Title"] = Model.IsEditMode ? Localizer["Edit {0}", Model.LookupTypeName].Value : Localizer["Create {0}", Model.LookupTypeName].Value;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="mb-0">@ViewData["Title"]</h4>
        @if (!string.IsNullOrEmpty(Model.TenantName))
        {
            <small class="text-muted">@Localizer["Tenant"]: @Model.TenantName</small>
        }
    </div>
    <a asp-action="List"
       asp-route-type="@Model.LookupType"
       asp-route-tenantId="@Model.TenantId"
       class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i>@Localizer["Back to List"]
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card card-rounded">
            <div class="card-body">
                <form asp-action="Save" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="Id" />
                    <input type="hidden" asp-for="LookupType" />
                    <input type="hidden" asp-for="LookupTypeName" />
                    <input type="hidden" asp-for="TenantId" />

                    <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                    <div class="row g-3">
                        <!-- Name -->
                        <div class="col-md-8">
                            <div class="form-group">
                                <label asp-for="Name" class="form-label">@Localizer["Name"] <span class="text-danger">*</span></label>
                                <input asp-for="Name" class="form-control" placeholder="@Localizer["Enter name"]" />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Code -->
                        <div class="col-md-4">
                            <div class="form-group">
                                <label asp-for="Code" class="form-label">@Localizer["Code"]</label>
                                <input asp-for="Code" class="form-control" placeholder="@Localizer["e.g., HIGH_PRIORITY"]" />
                                <span asp-validation-for="Code" class="text-danger"></span>
                                <small class="form-text text-muted">@Localizer["Optional unique identifier"]</small>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="col-12">
                            <div class="form-group">
                                <label asp-for="Description" class="form-label">@Localizer["Description"]</label>
                                <textarea asp-for="Description" class="form-control" rows="3" placeholder="@Localizer["Enter description"]"></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Display Order -->
                        <div class="col-md-4">
                            <div class="form-group">
                                <label asp-for="DisplayOrder" class="form-label">@Localizer["Display Order"]</label>
                                <input asp-for="DisplayOrder" class="form-control" type="number" min="0" max="9999" />
                                <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                                <small class="form-text text-muted">@Localizer["Lower numbers appear first"]</small>
                            </div>
                        </div>

                        <!-- Color Code -->
                        <div class="col-md-4">
                            <div class="form-group">
                                <label asp-for="ColorCode" class="form-label">@Localizer["Color Code"]</label>
                                <div class="input-group">
                                    <input asp-for="ColorCode" class="form-control" type="color" />
                                    <input asp-for="ColorCode" class="form-control" type="text" placeholder="#1F6FEB" />
                                </div>
                                <span asp-validation-for="ColorCode" class="text-danger"></span>
                                <small class="form-text text-muted">@Localizer["Hex color format"]</small>
                            </div>
                        </div>

                        <!-- Icon Class -->
                        <div class="col-md-4">
                            <div class="form-group">
                                <label asp-for="IconClass" class="form-label">@Localizer["Icon Class"]</label>
                                <input asp-for="IconClass" class="form-control" placeholder="bi-star" />
                                <span asp-validation-for="IconClass" class="text-danger"></span>
                                <small class="form-text text-muted">
                                    <a href="https://icons.getbootstrap.com/" target="_blank">@Localizer["Browse icons"]</a>
                                </small>
                            </div>
                        </div>

                        <!-- Active Status -->
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                <label asp-for="IsActive" class="form-check-label">@Localizer["Active"]</label>
                            </div>
                            <small class="form-text text-muted">@Localizer["Inactive items are hidden in dropdowns"]</small>
                        </div>

                        <!-- System Default -->
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input asp-for="IsSystemDefault" class="form-check-input" type="checkbox" />
                                <label asp-for="IsSystemDefault" class="form-check-label">@Localizer["System Default"]</label>
                            </div>
                            <small class="form-text text-muted">@Localizer["System defaults cannot be deleted"]</small>
                        </div>
                    </div>

                    <div class="mt-4 d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-1"></i>@Localizer["Save"]
                        </button>
                        <a asp-action="List"
                           asp-route-type="@Model.LookupType"
                           asp-route-tenantId="@Model.TenantId"
                           class="btn btn-outline-secondary">
                            @Localizer["Cancel"]
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Preview Panel -->
    <div class="col-lg-4">
        <div class="card card-rounded">
            <div class="card-body">
                <h6 class="mb-3">@Localizer["Preview"]</h6>

                <div class="p-3 border rounded mb-3">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <span id="preview-visual"
                                  class="d-inline-block"
                                  style="width: 32px; height: 32px; background-color: @(Model.ColorCode ?? "#1F6FEB"); border-radius: 4px; border: 1px solid #dee2e6;">
                            </span>
                        </div>
                        <div class="flex-grow-1">
                            <div class="fw-semibold" id="preview-name">@(Model.Name ?? "Sample Name")</div>
                            <small class="text-muted" id="preview-description">@(Model.Description ?? "Sample description")</small>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info small">
                    <i class="bi bi-lightbulb me-2"></i>
                    @Localizer["This preview shows how the item will appear in lists and dropdowns."]
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Live preview updates
        document.getElementById('Name').addEventListener('input', function (e) {
            document.getElementById('preview-name').textContent = e.target.value || 'Sample Name';
        });

        document.getElementById('Description').addEventListener('input', function (e) {
            document.getElementById('preview-description').textContent = e.target.value || 'Sample description';
        });

        document.querySelectorAll('input[name="ColorCode"]').forEach(function (input) {
            input.addEventListener('input', function (e) {
                var color = e.target.value || '#1F6FEB';
                document.getElementById('preview-visual').style.backgroundColor = color;
                document.querySelectorAll('input[name="ColorCode"]').forEach(function (i) {
                    i.value = color;
                });
            });
        });
    </script>
}
