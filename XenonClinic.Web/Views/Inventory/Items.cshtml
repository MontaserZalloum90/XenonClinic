@using Microsoft.AspNetCore.Mvc.Localization
@using XenonClinic.Core.Enums
@inject IViewLocalizer Localizer
@model List<XenonClinic.Web.Models.InventoryItemDto>
@{
    ViewData["Title"] = Localizer["InventoryItems"];
}

<div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-3 gap-2">
    <div>
        <h2 class="mb-0">@Localizer["InventoryItems"]</h2>
        <p class="text-muted">@Model.Count @Localizer["items"]</p>
    </div>
    <a asp-action="CreateItem" class="btn btn-xenon"><i class="bi bi-plus-lg"></i> @Localizer["NewItem"]</a>
</div>

<!-- Filters -->
<div class="card card-rounded mb-3">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-4 col-12">
                <label class="form-label">@Localizer["Category"]</label>
                <select name="category" class="form-select">
                    <option value="">@Localizer["AllCategories"]</option>
                    @foreach (InventoryCategory cat in Enum.GetValues(typeof(InventoryCategory)))
                    {
                        <option value="@cat" selected="@(ViewBag.Category == cat)">@cat.ToString()</option>
                    }
                </select>
            </div>
            <div class="col-md-6 col-12">
                <label class="form-label">@Localizer["Search"]</label>
                <input type="text" name="search" value="@ViewBag.Search" class="form-control" placeholder="@Localizer["SearchByItemCodeOrName"]" />
            </div>
            <div class="col-md-2 col-12 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">@Localizer["Filter"]</button>
            </div>
        </form>
    </div>
</div>

<!-- Items Table -->
<div class="card card-rounded">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>@Localizer["ItemCode"]</th>
                    <th>@Localizer["Name"]</th>
                    <th class="d-none d-md-table-cell">@Localizer["Category"]</th>
                    <th class="d-none d-lg-table-cell">@Localizer["Supplier"]</th>
                    <th class="text-end">@Localizer["Stock"]</th>
                    <th class="text-end d-none d-sm-table-cell">@Localizer["CostPrice"]</th>
                    <th class="text-end d-none d-lg-table-cell">@Localizer["SellingPrice"]</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.ItemCode</td>
                        <td>
                            @item.Name
                            @if (item.IsOutOfStock)
                            {
                                <span class="badge bg-danger ms-2">@Localizer["OutOfStock"]</span>
                            }
                            else if (item.IsLowStock)
                            {
                                <span class="badge bg-warning text-dark ms-2">@Localizer["LowStock"]</span>
                            }
                        </td>
                        <td class="d-none d-md-table-cell">@item.CategoryDisplay</td>
                        <td class="d-none d-lg-table-cell">@(item.SupplierName ?? "-")</td>
                        <td class="text-end">
                            <span class="badge @(item.IsOutOfStock ? "bg-danger" : item.IsLowStock ? "bg-warning text-dark" : "bg-success")">
                                @item.QuantityOnHand
                            </span>
                        </td>
                        <td class="text-end d-none d-sm-table-cell">AED @item.CostPrice.ToString("N2")</td>
                        <td class="text-end d-none d-lg-table-cell">AED @item.SellingPrice.ToString("N2")</td>
                        <td class="text-end">
                            <div class="btn-group btn-group-sm">
                                <a asp-action="EditItem" asp-route-id="@item.Id" class="btn btn-outline-primary">@Localizer["Edit"]</a>
                                <a asp-action="CreateTransaction" asp-route-itemId="@item.Id" class="btn btn-outline-secondary">@Localizer["Transaction"]</a>
                                <a asp-action="Transactions" asp-route-itemId="@item.Id" class="btn btn-outline-info">@Localizer["History"]</a>
                            </div>
                        </td>
                    </tr>
                }
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">@Localizer["NoItemsFound"]</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
