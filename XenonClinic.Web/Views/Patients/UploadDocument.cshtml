@inject IStringLocalizer<XenonClinic.Web.Resources.SharedResource> Localizer

@{
    ViewData["Title"] = Localizer["UploadDocument"];
    var patientId = ViewContext.RouteData.Values["id"];
}

<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">@Localizer["Home"]</a></li>
        <li class="breadcrumb-item"><a asp-controller="Patients" asp-action="Index">@Localizer["Patients"]</a></li>
        <li class="breadcrumb-item"><a asp-controller="Patients" asp-action="Details" asp-route-id="@patientId">@Localizer["PatientDetails"]</a></li>
        <li class="breadcrumb-item active" aria-current="page">@Localizer["UploadDocument"]</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">@Localizer["UploadDocument"]</h3>
</div>

<form asp-action="UploadDocument" asp-route-id="@patientId" method="post" enctype="multipart/form-data" class="card card-rounded p-3 p-md-4">
    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

    <!-- File Upload Section -->
    <div class="mb-4">
        <h5 class="border-bottom pb-2 mb-3">@Localizer["DocumentFile"]</h5>

        <div class="row g-3">
            <div class="col-12">
                <label for="file" class="form-label">@Localizer["SelectFile"] <span class="text-danger">*</span></label>
                <input type="file" class="form-control" id="file" name="file" required />
                <div class="form-text">@Localizer["MaxFileSize10MB"]</div>
            </div>
        </div>
    </div>

    <!-- Document Information Section -->
    <div class="mb-4">
        <h5 class="border-bottom pb-2 mb-3">@Localizer["DocumentInformation"]</h5>

        <div class="row g-3">
            <div class="col-md-6 col-12">
                <label for="documentType" class="form-label">@Localizer["DocumentType"] <span class="text-danger">*</span></label>
                <select class="form-select" id="documentType" name="documentType" required>
                    <option value="">@Localizer["SelectDocumentType"]</option>
                    <option value="ConsentForm">@Localizer["ConsentForm"]</option>
                    <option value="MedicalRecord">@Localizer["MedicalRecord"]</option>
                    <option value="IDCopy">@Localizer["IDCopy"]</option>
                    <option value="InsuranceCard">@Localizer["InsuranceCard"]</option>
                    <option value="LabReport">@Localizer["LabReport"]</option>
                    <option value="Prescription">@Localizer["Prescription"]</option>
                    <option value="Other">@Localizer["Other"]</option>
                </select>
            </div>

            <div class="col-md-6 col-12">
                <label for="expiryDate" class="form-label">@Localizer["ExpiryDate"]</label>
                <input type="date" class="form-control" id="expiryDate" name="expiryDate" />
                <div class="form-text">@Localizer["OptionalExpiryDate"]</div>
            </div>

            <div class="col-12">
                <label for="description" class="form-label">@Localizer["Description"]</label>
                <textarea class="form-control" id="description" name="description" rows="3" placeholder="@Localizer["EnterDocumentDescription"]"></textarea>
            </div>

            <div class="col-12">
                <label for="tags" class="form-label">@Localizer["Tags"]</label>
                <input type="text" class="form-control" id="tags" name="tags" placeholder="@Localizer["EnterTagsSeparatedByComma"]" />
                <div class="form-text">@Localizer["TagsHelpSearch"]</div>
            </div>
        </div>
    </div>

    <!-- Upload Instructions -->
    <div class="alert alert-info mb-4">
        <h6 class="alert-heading"><i class="bi bi-info-circle"></i> @Localizer["UploadInstructions"]</h6>
        <ul class="mb-0 ps-3">
            <li>@Localizer["MaxFileSize10MB"]</li>
            <li>@Localizer["SupportedFormatsAllCommon"]</li>
            <li>@Localizer["DocumentsStoredSecurely"]</li>
            <li>@Localizer["UseTagsForEasySearch"]</li>
        </ul>
    </div>

    <!-- Form Buttons -->
    <div class="mt-4 d-flex flex-column flex-sm-row justify-content-end gap-2">
        <a asp-action="Details" asp-route-id="@patientId" class="btn btn-outline-secondary">
            <i class="bi bi-x-lg"></i> @Localizer["Cancel"]
        </a>
        <button type="submit" class="btn btn-xenon">
            <i class="bi bi-upload"></i> @Localizer["UploadDocument"]
        </button>
    </div>
</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        // Display selected filename
        document.getElementById('file').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name;
            if (fileName) {
                const fileInput = e.target;
                const label = fileInput.nextElementSibling;
                if (label && label.classList.contains('form-text')) {
                    label.textContent = '@Localizer["SelectedFile"]: ' + fileName;
                }
            }
        });

        // File size validation (10MB)
        document.querySelector('form').addEventListener('submit', function(e) {
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];

            if (file && file.size > 10 * 1024 * 1024) {
                e.preventDefault();
                alert('@Localizer["FileSizeExceeds10MB"]');
                return false;
            }
        });
    </script>
}
