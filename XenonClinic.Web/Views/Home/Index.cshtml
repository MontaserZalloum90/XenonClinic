@model XenonClinic.Web.Models.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}
<div class="row g-3">
    <div class="col-md-3">
        <div class="card card-rounded">
            <div class="card-body">
                <div class="text-muted small">Appointments Today</div>
                <div class="fs-3 fw-bold text-primary">@Model.AppointmentsToday</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-rounded">
            <div class="card-body">
                <div class="text-muted small">Active Patients</div>
                <div class="fs-3 fw-bold text-success">@Model.ActivePatients</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-rounded">
            <div class="card-body">
                <div class="text-muted small">Visits This Week</div>
                <div class="fs-3 fw-bold text-info">@Model.VisitsThisWeek</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card card-rounded">
            <div class="card-body">
                <div class="text-muted small">Revenue This Month</div>
                <div class="fs-3 fw-bold text-warning">AED @Model.RevenueThisMonth.ToString("N2")</div>
            </div>
        </div>
    </div>
</div>

<div class="row g-3 mt-2">
    <div class="col-lg-8">
        <div class="card card-rounded">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Upcoming Appointments</h5>
                    <a class="btn btn-sm btn-primary" asp-controller="Patients" asp-action="Index">Manage Patients</a>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover table-xenon align-middle">
                        <thead>
                            <tr>
                                <th>When</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.UpcomingAppointments)
                            {
                                <tr>
                                    <td>@item.StartTime.ToString("dd MMM HH:mm")</td>
                                    <td>@item.Type</td>
                                    <td><span class="badge bg-secondary">@item.Status</span></td>
                                    <td>@item.Notes</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card card-rounded">
            <div class="card-body">
                <h5 class="mb-3">Visits (Last 7 days)</h5>
                <canvas id="visitsChart" height="220"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const visitsLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.VisitsSeries.Select(v => v.Date.ToString("dd MMM"))));
        const visitsData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.VisitsSeries.Select(v => v.Count)));
        const ctx = document.getElementById('visitsChart');
        if (ctx) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: visitsLabels,
                    datasets: [{
                        label: 'Visits',
                        data: visitsData,
                        fill: true,
                        borderColor: '#1F6FEB',
                        backgroundColor: 'rgba(31,111,235,0.12)',
                        tension: 0.3,
                        pointRadius: 4
                    }]
                },
                options: { plugins: { legend: { display: false } } }
            });
        }
    </script>
}
